<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Smart‚ÄëBin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

  <style>
    /* Re‚Äëuse same styles as admin */
    #gradientBG{position:fixed;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,#ff0080,#ff8c00,#40c8ff,#ff40ff);background-size:600% 600%;animation:swirl 15s ease infinite;opacity:.6;z-index:-10000}
    @keyframes swirl{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    #starfield,#starRain{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-9999}
    canvas{position:absolute;top:0;left:0;width:100%;height:100%}
    .fall{position:absolute;color:#fff;font-size:1rem;animation:fall 4s linear infinite}
    @keyframes fall{0%{transform:translateY(-20px);opacity:1}100%{transform:translateY(110vh);opacity:0}}
    :root{--fg:#0ff;--card:#111;--shadow:0 6px 20px rgba(0,255,255,.25)}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Orbitron',sans-serif;background:#000;color:var(--fg);overflow-x:hidden;padding:1rem}
    h1{text-align:center;font-size:2.2rem;margin-bottom:1rem;text-shadow:0 0 10px var(--fg)}
    #controls{text-align:center;margin-bottom:1rem;display:flex;justify-content:center;gap:.8rem;flex-wrap:wrap}
    #controls button{background:var(--fg);color:#000;border:none;padding:.6rem 1.2rem;border-radius:8px;cursor:pointer;box-shadow:var(--shadow);transition:.3s}
    #controls button:hover{transform:scale(1.05)}
    #feed{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:1.2rem}
    .card{background:var(--card);border-radius:12px;box-shadow:var(--shadow);overflow:hidden;position:relative;display:flex;flex-direction:column;min-height:380px}
    .title{font-size:1.1rem;padding:1rem 1rem .4rem;color:var(--fg)}
    .card img{width:100%;object-fit:cover;flex-shrink:0;height:200px;filter:brightness(1.15) contrast(1.25)}
    ul.reasons{list-style:disc;padding:0 1.2rem;margin:1rem 0 2rem;font-size:.95rem}
    ul.reasons li{margin:.2rem 0}
    .time{position:absolute;bottom:10px;right:14px;font-size:.75rem;color:var(--fg)}
    /* toast */
    #toast{position:fixed;top:1rem;left:50%;transform:translateX(-50%);background:var(--fg);color:#000;padding:.8rem 1.5rem;border-radius:5px;opacity:0;pointer-events:none}
    @keyframes show{0%{opacity:0}15%{opacity:1}85%{opacity:1}100%{opacity:0}}
  </style>
</head>
<body>
  <div id="gradientBG"></div>
  <div id="starfield"><canvas id="sf1"></canvas></div>
  <div id="starRain"></div>

  <h1>Smart‚ÄëBin</h1>
  <div id="controls">
    <button id="shoot">üì∏¬†Take¬†Picture</button>
    <button id="clearMe">üóëÔ∏è¬†Clear¬†My¬†History</button>
  </div>
  <div id="feed">Loading‚Ä¶</div>
  <div id="toast">Captured!</div>

<script>
/* starfield & rain identical to admin */
(function(){
  const c=document.getElementById('sf1'),ctx=c.getContext('2d');
  function resize(){c.width=innerWidth;c.height=innerHeight}
  addEventListener('resize',resize);resize();
  const stars=[...Array(250)].map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,r:Math.random()*1.2,s:0.5+Math.random()*0.8}));
  (function anim(){
    ctx.clearRect(0,0,c.width,c.height);ctx.fillStyle='#fff';
    stars.forEach(s=>{s.y+=s.s;if(s.y>c.height)s.y=0;ctx.fillRect(s.x,s.y,s.r,s.r)});
    requestAnimationFrame(anim);
  })();
  setInterval(()=>{if(Math.random()<.7){const s=document.createElement('span');s.className='fall';s.textContent='‚ú¶';s.style.left=Math.random()*innerWidth+'px';document.getElementById('starRain').append(s);setTimeout(()=>s.remove(),4000)}},500);
})();

/* UID + toast */
const uid=localStorage.uid||crypto.randomUUID();localStorage.uid=uid;
function toast(msg){const t=document.getElementById('toast');t.textContent=msg;t.style.animation='show 3s ease';setTimeout(()=>t.style.animation='none',3000)}

/* Build card */
function makeCard(rec){
  const [cat,obj]=rec.report.split(';').map(s=>s.trim());
  return `
  <div class="card">
    <div class="title">${obj} ‚Äì ${cat}</div>
    <img src="data:image/jpeg;base64,${rec.b64}">
    <ul class="reasons">
      <li>${rec.report.split('\n')[1]||''}</li>
      <li>${rec.report.split('\n')[2]||''}</li>
    </ul>
    <div class="time">${new Date(rec.ts).toLocaleString()}</div>
  </div>`;
}

/* Load feed */
async function load(){const r=await fetch('/api/records?uid='+uid);const data=await r.json();const feed=document.getElementById('feed');feed.innerHTML='';if(!data.length){feed.textContent='No history yet.';return;}data.forEach(rec=>feed.insertAdjacentHTML('beforeend',makeCard(rec)));}
load();setInterval(load,5000);

/* Capture / clear */
shoot.onclick=async()=>{toast('Capturing‚Ä¶');await fetch('/trigger?uid='+uid);toast('Captured!');};
clearMe.onclick=async()=>{if(!confirm('Delete your history?'))return;await fetch('/clear-user?uid='+uid,{method:'POST'});load();toast('Cleared');};
</script>
</body>
</html>
