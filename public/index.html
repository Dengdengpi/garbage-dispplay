<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Smartâ€‘Bin Admin Feed</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Orbitron Font -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet"/>

  <style>
    /* â”€â”€â”€â”€â”€ gradientSWIRL â”€â”€â”€â”€â”€ */
    #gradientBG {
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:linear-gradient(135deg,#ff0080,#ff8c00,#40c8ff,#ff40ff);
      background-size:600% 600%; animation:swirl 15s ease infinite;
      opacity:0.7; z-index:-10000;
    }
    @keyframes swirl {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    /* â”€â”€â”€â”€â”€ starfields & rain â”€â”€â”€â”€â”€ */
    #starfieldContainer, #starRainContainer {
      position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-9999;
    }
    canvas.starfield { position:absolute;top:0;left:0;width:100%;height:100%; }
    .falling-star {
      position:absolute;color:#fff;font-size:1rem;
      animation:rain 4s linear infinite;
    }
    @keyframes rain {
      0%{transform:translateY(-20px);opacity:1}
      100%{transform:translateY(110vh);opacity:0}
    }
    /* â”€â”€â”€â”€â”€ globals â”€â”€â”€â”€â”€ */
    :root {
      --bg:#000; --fg:#0ff; --card-bg:rgba(0,0,0,0.7);
      --shadow:0 10px 30px rgba(0,255,255,0.2)
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body {
      background:var(--bg); color:var(--fg);
      font-family:'Orbitron',sans-serif; overflow-x:hidden; padding:1rem;
    }
    h1 {
      text-align:center; font-size:2.5rem; margin-bottom:1rem;
      text-shadow:0 0 10px var(--fg),0 0 20px var(--fg);
      animation:neon 1.5s ease-in-out infinite alternate;
    }
    @keyframes neon {
      from{text-shadow:0 0 5px var(--fg)} to{text-shadow:0 0 30px var(--fg)}
    }
    #controls { text-align:center; margin-bottom:1rem; }
    #clearAll {
      padding:0.5rem 1rem; border:2px solid var(--fg);
      background:transparent; color:var(--fg);
      border-radius:8px; cursor:pointer;
      transition:0.3s;
    }
    #clearAll:hover {
      background:var(--fg); color:var(--bg);
      box-shadow:var(--shadow); transform:scale(1.05);
    }
    /* â”€â”€â”€â”€â”€ deck of cards â”€â”€â”€â”€â”€ */
    #deck {
      position:relative; width:100%; max-width:800px; height:500px;
      margin:auto; perspective:1000px;
    }
    .card {
      position:absolute; top:0; left:50%;
      width:90%; max-width:400px; transform-origin:top center;
      background:var(--card-bg); border-radius:12px; overflow:hidden;
      box-shadow:var(--shadow); cursor:grab;
      transition:transform 0.5s ease,z-index 0.5s;
    }
    .card img {
      width:100%; display:block; filter:brightness(1.2) contrast(1.3);
    }
    .card .content {
      padding:1rem; text-align:left;
    }
    .card .content h3 {
      font-size:1.25rem; margin-bottom:0.5rem; color:var(--fg);
    }
    .card .content p {
      margin:0.3rem 0; font-size:0.95rem; line-height:1.4; color:var(--fg);
    }
    .card .time {
      position:absolute; bottom:8px; right:12px;
      font-size:0.75rem; color:var(--fg);
    }
  </style>
</head>
<body>
  <div id="gradientBG"></div>
  <div id="starfieldContainer">
    <canvas class="starfield" id="sf1"></canvas>
    <canvas class="starfield" id="sf2"></canvas>
    <canvas class="starfield" id="sf3"></canvas>
    <canvas class="starfield" id="sf4"></canvas>
  </div>
  <div id="starRainContainer"></div>

  <h1>Smartâ€‘Bin Admin</h1>
  <div id="controls">
    <button id="clearAll">ðŸ§¹ Clear All History</button>
  </div>
  <div id="deck"></div>

  <script>
  /* â”€â”€â”€ starfield layers â”€â”€â”€ */
  [ "sf1","sf2","sf3","sf4" ].forEach((id,i)=>{
    const c=document.getElementById(id), ctx=c.getContext("2d");
    function resize(){ c.width=innerWidth; c.height=innerHeight; }
    window.addEventListener("resize",resize); resize();
    const count=200 + i*50;
    const stars=Array.from({length:count},()=>({
      x:Math.random()*c.width,
      y:Math.random()*c.height,
      r:Math.random()*1.5,
      s:0.2 + i*0.3 + Math.random()*0.5
    }));
    (function anim(){
      ctx.clearRect(0,0,c.width,c.height);
      ctx.fillStyle="#fff";
      stars.forEach(st=>{
        st.y+=st.s; if(st.y>c.height) st.y=0;
        ctx.fillRect(st.x,st.y,st.r,st.r);
      });
      requestAnimationFrame(anim);
    })();
  });
  /* â”€â”€â”€ star rain â”€â”€â”€ */
  setInterval(()=>{
    if(Math.random()<0.6){
      const sp=document.createElement("span");
      sp.className="falling-star"; sp.innerText="*";
      sp.style.left=Math.random()*innerWidth+"px";
      document.getElementById("starRainContainer").append(sp);
      setTimeout(()=>sp.remove(),4000);
    }
  },500);

  /* â”€â”€â”€ load & render deck â”€â”€â”€ */
  let records=[];
  async function loadData(){
    const r=await fetch('/api/records');
    records=await r.json();
    renderDeck();
  }
  function renderDeck(){
    const deck=document.getElementById('deck');
    deck.innerHTML='';
    records.forEach((rec,i)=>{
      const idx=records.length-1-i;
      const card=document.createElement('div');
      card.className='card';
      card.style.zIndex=i;
      const offset=i*8, scale=1 - (records.length-1-i)*0.02;
      card.style.transform=`translate(-50%,${offset}px) scale(${scale})`;
      card.innerHTML=`
        <img src="data:image/jpeg;base64,${rec.b64}" loading="lazy">
        <div class="content">
          <h3>${rec.report.split('\n')[0]}</h3>
          <p><strong>1:</strong> ${rec.report.split('\n')[1]||''}</p>
          <p><strong>2:</strong> ${rec.report.split('\n')[2]||''}</p>
        </div>
        <div class="time">${new Date(rec.ts).toLocaleString()}</div>
      `;
      card.addEventListener('click', ()=>{
        const sel=records.splice(i,1)[0];
        records.push(sel);
        renderDeck();
      });
      deck.append(card);
    });
  }

  /* â”€â”€â”€ swipe support â”€â”€â”€ */
  (()=> {
    let sx=0;
    const deck=document.getElementById('deck');
    deck.addEventListener('touchstart',e=>sx=e.touches[0].clientX);
    deck.addEventListener('touchend',e=>{
      const dx=e.changedTouches[0].clientX - sx;
      if(Math.abs(dx)>50){
        if(dx<0) records.unshift(records.pop());
        else     records.push(records.shift());
        renderDeck();
      }
    });
  })();

  /* â”€â”€â”€ clear all â”€â”€â”€ */
  document.getElementById('clearAll').onclick=async()=>{
    if(!confirm('Clear all history?'))return;
    await fetch('/clear-all',{method:'POST'});
    loadData();
  };

  loadData();
  setInterval(loadData,5000);
  </script>
</body>
</html>
