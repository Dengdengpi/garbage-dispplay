<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Smartâ€‘Bin Admin</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
    /* â”€â”€â”€â”€â”€ Swirling Gradient Background â”€â”€â”€â”€â”€ */
    #gradientBG {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: linear-gradient(135deg,#ff0080,#ff8c00,#40c8ff,#ff40ff);
      background-size:600% 600%;
      animation: swirl 15s ease infinite;
      opacity: .6; z-index:-10000;
    }
    @keyframes swirl {
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }

    /* â”€â”€â”€â”€â”€ Starfield & Rain â”€â”€â”€â”€â”€ */
    #starfield,#starRain {
      position: fixed; top:0; left:0; width:100%; height:100%;
      pointer-events: none; z-index:-9999;
    }
    canvas { position:absolute; width:100%; height:100%; }
    .fall { position:absolute; color:#fff; font-size:1rem; animation: fall 4s linear infinite; }
    @keyframes fall {
      0% { transform: translateY(-20px); opacity:1; }
      100% { transform: translateY(110vh); opacity:0; }
    }

    /* â”€â”€â”€â”€â”€ Global & Card Styles â”€â”€â”€â”€â”€ */
    body {
      margin:0; padding:1rem;
      font-family: Arial, sans-serif;
      background: transparent;
      color: #fff;
      overflow-x: hidden;
    }
    h1 {
      text-align:center; margin-bottom:1rem;
      text-shadow: 0 0 10px #fff, 0 0 25px #fff;
    }
    #controls { text-align:center; margin-bottom:1rem; }
    #clearAll {
      padding:.5rem 1rem; border:1px solid #fff;
      background: rgba(255,255,255,0.1); color:#fff;
      border-radius:4px; cursor:pointer; transition:.3s;
    }
    #clearAll:hover {
      background: rgba(255,255,255,0.3);
    }

    #feed {
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(260px,1fr));
      gap:1rem;
    }
    .card {
      background: rgba(0,0,0,0.6);
      border-radius:8px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      box-shadow:0 4px 12px rgba(0,0,0,0.5);
      transition: transform .2s;
    }
    .card:hover {
      transform: scale(1.02);
    }
    .card img {
      width:100%; height:auto; object-fit:cover;
    }
    .title {
      text-align:center; font-weight:bold;
      padding:.6rem 1rem; border-bottom:1px solid rgba(255,255,255,0.2);
    }
    .comments {
      flex-grow:1; padding: .8rem 1rem;
      font-size:.9rem; line-height:1.3; color:#ddd;
    }
    .time {
      text-align:right; font-size:.75rem;
      padding:.5rem 1rem; color:#ccc;
    }
  </style>
</head>
<body>
  <!-- Background layers -->
  <div id="gradientBG"></div>
  <div id="starfield">
    <canvas id="sf1"></canvas>
    <canvas id="sf2"></canvas>
    <canvas id="sf3"></canvas>
    <canvas id="sf4"></canvas>
  </div>
  <div id="starRain"></div>

  <h1>Smartâ€‘Bin Admin</h1>
  <div id="controls">
    <button id="clearAll">ðŸ§¹ Clear All History</button>
  </div>
  <div id="feed">Loadingâ€¦</div>

  <script>
    // â”€â”€â”€ Starfield Layers â”€â”€â”€
    ['sf1','sf2','sf3','sf4'].forEach((id,i)=>{
      const c=document.getElementById(id), ctx=c.getContext('2d');
      function resize(){ c.width=innerWidth; c.height=innerHeight; }
      window.addEventListener('resize',resize); resize();
      const count=200 + i*50;
      const stars=Array.from({length:count},()=>({
        x:Math.random()*c.width,
        y:Math.random()*c.height,
        r:Math.random()*1.5,
        s:0.2 + i*0.3 + Math.random()*0.5
      }));
      (function draw(){
        ctx.clearRect(0,0,c.width,c.height);
        ctx.fillStyle='#fff';
        stars.forEach(s=>{ s.y+=s.s; if(s.y>c.height) s.y=0; ctx.fillRect(s.x,s.y,s.r,s.r) });
        requestAnimationFrame(draw);
      })();
    });

    // â”€â”€â”€ Star Rain â”€â”€â”€
    setInterval(()=>{
      if(Math.random()<.6){
        const sp=document.createElement('span');
        sp.className='fall'; sp.textContent='âœ¦';
        sp.style.left=Math.random()*innerWidth+'px';
        document.getElementById('starRain').append(sp);
        setTimeout(()=>sp.remove(),4000);
      }
    },500);

    // â”€â”€â”€ Build Card HTML â”€â”€â”€
    function makeCard(rec){
      const parts=rec.report.split('\n');
      let [cat,obj]=parts[0].split(';').map(s=>s.trim());
      const title=`${obj}Â â€“Â ${cat}`;
      const c1=parts[1]||'', c2=parts[2]||'';
      const time=new Date(rec.ts).toLocaleString();
      return `
        <div class="card">
          <img src="data:image/jpeg;base64,${rec.b64}">
          <div class="title">${title}</div>
          <div class="comments">
            <p>${c1}</p><p>${c2}</p>
          </div>
          <div class="time">${time}</div>
        </div>`;
    }

    // â”€â”€â”€ Load & Render â”€â”€â”€
    async function loadFeed(){
      const r=await fetch('/api/records'), data=await r.json();
      const feed=document.getElementById('feed');
      feed.innerHTML='';
      if(!data.length){ feed.textContent='No records.'; return; }
      data.forEach(rec=> feed.insertAdjacentHTML('beforeend',makeCard(rec)));
    }
    loadFeed();
    setInterval(loadFeed,5000);

    // â”€â”€â”€ Clear All â”€â”€â”€
    document.getElementById('clearAll').onclick=async()=>{
      if(!confirm('Delete EVERYTHING?'))return;
      await fetch('/clear-all',{method:'POST'});
      loadFeed();
    };
  </script>
</body>
</html>
